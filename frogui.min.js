function sleep(n){return new Promise(t=>{setTimeout(t,n)})}function doDomContentLoaded(){}function b64toBlob(n,t,i){var e,o,r,f,s,u,h;for(t=t||"",i=i||512,e=atob(n),o=[],r=0;r<e.length;r+=i){for(f=e.slice(r,r+i),s=new Array(f.length),u=0;u<f.length;u++)s[u]=f.charCodeAt(u);h=new Uint8Array(s);o.push(h)}return new Blob(o,{type:t})}function removeAllChildren(n){while(n.hasChildNodes())n.removeChild(n.lastChild)}function uploadBlobFileAsync(n,t){var i=new XMLHttpRequest;i.open("GET",n,!0);i.responseType="blob";i.onload=function(){var n=i.response;t(n)};i.send()}function uploadBase64Async(n,t){uploadBlobFileAsync(n,function(n){var i=new FileReader;i.readAsDataURL(n);i.onloadend=function(){var n=i.result;t(n)}})}function processKeyEvent(n,t){var u=t.key,i=t.which,f=t.originalEvent.code,r;return KeyCode.shift===i||KeyCode.ctrl===i||KeyCode.alt===i?!0:(r=new KeyboardRelayEventArgs(u,i,f,t.altKey,t.ctrlKey,t.metaKey,t.shiftKey,t.timeStamp),Wormhole.relayEvent(n,t.type,JSON.stringify(r)),!0)}function processMouseEvent(n,t){var i=new PointerRelayEventArgs(t.altKey,t.ctrlKey,t.metaKey,t.shiftKey,t.button,t.timeStamp);return Wormhole.relayEvent(n,t.type,JSON.stringify(i)),!0}function connectListeners(n,t){$(t).on("mouseenter",function(t){processMouseEvent(n,t)});$(t).on("mouseleave",function(t){processMouseEvent(n,t)});$(t).on("mouseup",function(t){processMouseEvent(n,t)});$(t).on("mousedown",function(t){processMouseEvent(n,t)});$(t).on("keydown",function(t){return processKeyEvent(n,t)});$(t).on("keyup",function(t){return processKeyEvent(n,t)})}function element_addClassItem(n,t){n.classList.add(t)}function element_removeClassItem(n,t){n.classList.remove(t)}function findImageSourceIndex(n){for(var t=0;t<imageSource_ids.length;++t)if(imageSource_ids[t]==n)return t;return-1}function imageSourceManager_addImage(n,t,i){var e=URL.createObjectURL(t),o=e.toString(),f,r,u,s;imageSource_ids.push(n);imageSource_urls.push(e);f=new Image;f.onload=function(){i(o,f.width,f.height)};f.src=e;r=document.createElementNS(SvgNamespace,"pattern");r.id=n+"_pattern";r.setAttribute("width","100%");r.setAttribute("height","100%");r.setAttribute("patternContentUnits","objectBoundingBox");u=document.createElementNS(SvgNamespace,"image");u.setAttribute("width","1");u.setAttribute("height","1");u.setAttribute("preserveAspectRatio","none");u.setAttribute("href",o);r.appendChild(u);s=document.getElementById("e_svgDefs");s.appendChild(r)}function imageSourceManager_addImageAsync(n,t,i){uploadBlobFileAsync(t,function(t){imageSourceManager_addImage(n,t,i)})}function imageSourceManager_removeImage(n){var t=findImageSourceIndex(n),i,r;delete imageSource_ids[t];delete imageSource_urls[t];i=document.getElementById("e_svgDefs");r=document.getElementById(n+"_pattern");i.removeChild(r)}function styleSheet_getRuleIndex(n){for(var u,r,i=document.styleSheets,f=i.length,t=0;t<f;t++){if(i[t].rules)u=i[t].rules;else{try{if(!i[t].cssRules)continue}catch(e){if(e.name=="SecurityError"){console.log("SecurityError. Cant read: "+i[t].href);continue}}u=i[t].cssRules}for(r=0;r<u.length;r++)if(u[r].selectorText==n)return r;return-1}}function jetson_getRuleIndex(n){var i,t;if(css_jetson.rules)i=css_jetson.rules;else{try{if(!css_jetson.cssRules)return-1}catch(r){if(r.name=="SecurityError")return console.log("SecurityError. Cant read: "+css_jetson.href),-1}i=css_jetson.cssRules}for(t=0;t<i.length;t++)if(i[t].selectorText==n)return t;return-1}function jetson_addRule(n,t){var i=n+" {\n"+t+"}";css_jetson.insertRule(i,css_jetson.cssRules.length)}function jetson_removeRuleBySelector(n){var t=jetson_getRuleIndex(n);css_jetson.deleteRule(t)}function console_fireGenericEvent(n){var t=new RelayEventArgs(Date.now);Wormhole.relayEvent(n,"genericConsole",JSON.stringify(t))}function console_createColoredElement(n,t,i){var r=document.createElement(n);return r.style.color=t,r.style.backgroundColor=i,r}function console_clear(n,t,i,r){var u=document.getElementById(n);t&&(document.body.style.backgroundColor=i);u.style.backgroundColor=i;u.style.fontSize=r;removeAllChildren(u);console_fireGenericEvent(n)}function console_readKey(n,t,i,r){var f=document.getElementById(n),u=console_createColoredElement("textarea",i,r);u.className+=t?"console_readKey_intercept":"console_readKey";u.rows=1;u.onkeydown=function(t){var i=t.keyCode,r;if(KeyCode.shift!==i&&KeyCode.ctrl!==i&&KeyCode.alt!==i)return t.preventDefault(),u.readOnly=!0,u.blur(),r=new ConsoleReadKeyWormholeArgs(t.key,t.code,t.altKey,t.ctrlKey,t.metaKey,t.shiftKey),Wormhole.readKey_Return(n,r),!0};f.appendChild(u);u.focus()}function console_readLine(n,t,i){var u=document.getElementById(n),r=console_createColoredElement("textarea",t,i);r.className+="console_readLine";r.rows=1;r.oninput=function(){r.style.height="";r.style.height=r.scrollHeight+"px"};r.onkeypress=function(t){var i=t.keyCode;if(KeyCode.enter==i)return t.preventDefault(),r.readOnly=!0,r.blur(),Wormhole.readLine_Return(n,r.value),!1};u.appendChild(r);r.focus()}function console_write(n,t,i,r){var f=atob(t),e=document.getElementById(n),u=console_createColoredElement("span",i,r);u.className+="console_write";u.innerText=f;e.appendChild(u);console_fireGenericEvent(n)}function console_writeLine_empty(n){var t=document.getElementById(n),i=document.createElement("br");t.appendChild(i);console_fireGenericEvent(n)}function console_writeLine(n,t,i,r){var f=atob(t),e=document.getElementById(n),u=console_createColoredElement("div",i,r);u.innerText=f;e.appendChild(u);console_fireGenericEvent(n)}function application_alert(n){alert(n)}function application_deleteElement(n){var t=document.getElementById(n);t.parentNode.removeChild(t)}function updateElement(n,t,i){if(n.style.cssText=t?t:"",i)for(var u=i.split(" "),r=0;r<u.length;++r)n.classList.add(u[r]);else n.classList=""}function insertElement_a(n,t,i){if(t>=n.childNodes.length)n.appendChild(i);else{var r=n.childNodes[t];n.insertBefore(i,r)}}function insertElement_b(n,t,i,r,u,f){r.id=i;updateElement(r,u,f);insertElement_a(n,t,r)}function insertElement_c(n,t,i,r,u,f){connectListeners(i,r);var e=document.getElementById(n);insertElement_b(e,t,i,r,u,f)}function insertElement_Decorator(n,t,i){var r=document.createElement("div");return insertElement_c(n,t,i,r,"","decorator"),r}function insertElement_Border(n,t,i){var r=document.createElement("div");return insertElement_c(n,t,i,r,"","border"),r}function insertElement_ComboBox(n){return parent=document.getElementById(n),fetch("comboBox.html").then(n=>n.text()).then(n=>parent.innerHTML+=n),parent.childNodes[0]}function insertElement_Console(n,t,i){var r=document.createElement("div");return insertElement_c(n,t,i,r,"","console"),r}function insertElement_Control(n,t,i){var r=document.createElement("div");return insertElement_c(n,t,i,r,"","control"),r}function insertElement_Ellipse(n,t,i){var u=document.createElementNS(SvgNamespace,"svg"),r;return insertElement_c(n,t,i,u,ShapeCssStyle,""),r=document.createElementNS(SvgNamespace,"ellipse"),r.setAttribute("cx","50%"),r.setAttribute("cy","50%"),r.setAttribute("rx","50%"),r.setAttribute("ry","50%"),insertElement_b(u,0,i+"_shape",r,"",""),u}function insertElement_Flex(n,t,i){var r=document.createElement("div");return insertElement_c(n,t,i,r,"","flex"),r}function insertElement_Grid(n,t,i){var r=document.createElement("div");return insertElement_c(n,t,i,r,"","grid"),r}function insertElement_Image(n,t,i){var r=document.createElement("img");return insertElement_c(n,t,i,r,"",""),r}function insertElement_ListBox(n,t,i){var r=document.createElement("div"),u;return insertElement_c(n,t,i,r,"","listBox"),u=document.createElement("div"),insertElement_b(r,0,"q_panel",u,"",""),r}function insertElement_Path(n,t,i){var r=document.createElementNS(SvgNamespace,"svg"),u;return insertElement_c(n,t,i,r,ShapeCssStyle,""),r.setAttribute("preserveAspectRatio","none"),u=document.createElementNS(SvgNamespace,"path"),u.setAttribute("vector-effect","non-scaling-stroke"),insertElement_b(r,0,i+"_shape",u,"",""),r}function insertElement_Rectangle(n,t,i){var u=document.createElementNS(SvgNamespace,"svg"),r;return insertElement_c(n,t,i,u,ShapeCssStyle,""),r=document.createElementNS(SvgNamespace,"rect"),r.setAttribute("x","0"),r.setAttribute("y","0"),r.setAttribute("width","100%"),r.setAttribute("height","100%"),insertElement_b(u,0,i+"_shape",r,"",""),u}function insertElement_TextBlock(n,t,i){var r=document.createElement("div");return insertElement_c(n,t,i,r,"","textBlock"),r}function insertElement_TextBoxMotif(n,t,i){var r=document.createElement("textarea");$(r).on("change",function(){var n=btoa(r.value),t=new TextChangeRelayEventArgs(n,event.timeStamp);return Wormhole.relayEvent(i,"textChange",JSON.stringify(t)),!0});$(r).on("keydown",function(n){if(n.keyCode===13&&!1===$(r).hasClass("textBoxBase__acceptsReturn--true"))return n.preventDefault(),!1});return insertElement_c(n,t,i,r,"","textBoxMotif"),r}function insertElement_Window(n,t,i){var r=document.createElement("div");return insertElement_c(n,t,i,r,"",""),r}function applyDomElements(n){n.Items.forEach(function(n){var t=document.getElementById(n.Id);n.OrigAttributes.forEach(function(n){t.removeAttribute(n)});n.NewAttributes.forEach(function(n){t.setAttribute(n.Name,n.Value)});n.OrigClasses.forEach(function(n){element_removeClassItem(t,n)});n.NewClasses.forEach(function(n){element_addClassItem(t,n)});n.OrigProperties.forEach(function(n){t.style[n]=null});n.NewProperties.forEach(function(n){t.style[n.Name]=n.Value})})}function applyElementSpecialActions(n,t){t.forEach(function(t){switch(t.Id){case ESAID.AddWindowTitle:document.title=t.Title;break;case ESAID.DeleteWindowTitle:document.title=null;break;case ESAID.AddTextBlockText:n.textContent=t.Text;break;case ESAID.DeleteTextBlockText:n.textContent=null;break;case ESAID.AddTextBoxText:n.value=t.Text;break;case ESAID.DeleteTextBoxText:n.value=null;break;default:console.log("scopeSyncElementSpecialActions() unknown Id '"+t.Id+"'.")}})}function application_applyElementActionset(n,t,i){var r=[],u=JSON.parse(i);u.Items.forEach(function(n){if(EAID.DeleteElement==n.Id)application_deleteElement(n.ElementId);else if(EAID.MoveElement===n.Id||EAID.ShiftElement===n.Id){var t=document.getElementById(n.ElementId);t.parentElement.removeChild(t);r.push(t)}});u.Items.forEach(function(n){var t,i;if(EAID.DeleteElement!=n.Id){if(t=null,EAID.ChangeElement===n.Id)t=document.getElementById(n.ElementId);else if(EAID.ShiftElement===n.Id||EAID.MoveElement===n.Id)t=r.find(function(t){return t.id===n.ElementId}),i=document.getElementById(n.VisibleParentElementId),insertElement_a(i,n.Index,t);else if(EAID.InsertElement==n.Id){var i=n.VisualParentElementId,u=n.Index,f=n.ElementId;switch(n.TypeName){case"Decorator":t=insertElement_Decorator(i,u,f);break;case"Border":t=insertElement_Border(i,u,f);break;case"ComboBox":t=insertElement_ComboBox(i,u,f);break;case"Console":t=insertElement_Console(i,u,f);break;case"Control":t=insertElement_Control(i,u,f);break;case"Ellipse":t=insertElement_Ellipse(i,u,f);break;case"Flex":t=insertElement_Flex(i,u,f);break;case"Grid":t=insertElement_Grid(i,u,f);break;case"Image":t=insertElement_Image(i,u,f);break;case"ListBox":t=insertElement_ListBox(i,u,f);break;case"Path":t=insertElement_Path(i,u,f);break;case"Rectangle":t=insertElement_Rectangle(i,u,f);break;case"TextBlock":t=insertElement_TextBlock(i,u,f);break;case"TextBoxMotif":t=insertElement_TextBoxMotif(i,u,f);break;case"Window":t=insertElement_Window(i,u,f);break;default:console.log("lesarde-error: unknown type '"+n.TypeName+"'.")}}applyDomElements(n.DomElements);applyElementSpecialActions(t,n.SpecialActions)}});Wormhole.applyActionset_Return(n,t)}function process_addRuleAction(n){var t="";n.Properties.forEach(function(n){t+=n.Name+": "+n.Value+";\n"});jetson_addRule(n.Selector,t)}function process_changeRuleAction(n){var i=jetson_getRuleIndex(n.Selector),r,t;-1==i&&console.log("error in changeRuleAction_properties() -- could not find style rule '"+property.Selector+"'.");r=css_jetson.rules[i];t=r.style;n.Properties.forEach(function(n){t.setProperty(n.Name,n.Value)});n.DeletePropertyNames.forEach(function(n){t.removeProperty(n)})}function process_deleteRuleAction(n){jetson_removeRuleBySelector(n.Selector)}function process_addBitmapImageAction(n){imageSourceManager_addImageAsync(n.BitmapImageId,n.Uri,function(t,i,r){Wormhole.addImageSource_Return(n.BitmapImageId,t,i,r)})}function process_deleteBitmapImageAction(n){imageSourceManager_removeImage(n.BitmapImageId)}function process_addGradientAction(n,t){n.id=t.BrushId;t.Stops&&t.Stops.forEach(function(t){var i=document.createElementNS(SvgNamespace,"stop");i.setAttribute("offset",t.Offset);i.setAttribute("style","stop-color:"+t.Color);n.appendChild(i)});var i=document.getElementById("e_svgDefs");i.appendChild(n)}function process_addLinearGradientBrushAction(n){var t=document.createElementNS(SvgNamespace,"linearGradient");t.setAttribute("x1",n.X1);t.setAttribute("y1",n.Y1);t.setAttribute("x2",n.X2);t.setAttribute("y2",n.Y2);process_addGradientAction(t,n)}function process_deleteGradientBrushAction(n){var t=document.getElementById(n.BrushId),i=document.getElementById("e_svgDefs");i.removeChild(t)}function process_addRadialGradientBrushAction(n){var t=document.createElementNS(SvgNamespace,"radialGradient");process_addGradientAction(t,n)}function application_applyAssetActionset(n,t,i){try{var r=JSON.parse(i)}catch(u){console.log(u)}r.Items.forEach(function(n){switch(n.Id){case AAID.AddRule:process_addRuleAction(n);break;case AAID.ChangeRule:process_changeRuleAction(n);break;case AAID.DeleteRule:process_deleteRuleAction(n);break;case AAID.AddBitmapImage:process_addBitmapImageAction(n);break;case AAID.DeleteBitmapImage:process_deleteBitmapImageAction(n);break;case AAID.AddLinearGradientBrush:process_addLinearGradientBrushAction(n);break;case AAID.DeleteLinearGradientBrush:process_deleteGradientBrushAction(n);break;case AAID.AddRadialGradientBrush:process_addRadialGradientBrushAction(n);break;case AAID.DeleteRadialGradientBrush:process_deleteGradientBrushAction(n);break;default:console.log("application_applyAssetActionset() unknown Id '"+n.Id+"'.")}});Wormhole.applyActionset_Return(n,t)}var element,css_jetson,imageSource_ids,imageSource_urls,KeyCode;class RelayEventArgs{constructor(n){this.Timestamp=n}}class PointerRelayEventArgs{constructor(n,t,i,r,u,f){this.AltKey=n;this.CtrlKey=t;this.MetaKey=i;this.ShiftKey=r;this.Button=u;this.Timestamp=f}}class KeyboardRelayEventArgs{constructor(n,t,i,r,u,f,e,o){this.Key=n;this.Which=t;this.OrigCode=i;this.AltKey=r;this.CtrlKey=u;this.MetaKey=f;this.ShiftKey=e;this.Timestamp=o}}class TextChangeRelayEventArgs{constructor(n,t){this.TextBase64=n;this.Timestamp=t}}element=document.createElement("style");element.title="css_jetson";document.head.appendChild(element);css_jetson=element.sheet;connectListeners("x_document",document);const SvgNamespace="http://www.w3.org/2000/svg",ShapeCssStyle="overflow:visible; box-sizing:border-box;";imageSource_ids=[];imageSource_urls=[];KeyCode=Object.freeze({enter:13,shift:16,ctrl:17,alt:18});class ConsoleReadKeyWormholeArgs{constructor(n,t,i,r,u,f){this.key=n;this.code=t;this.isAltKey=i;this.isCtrlKey=r;this.isMetaKey=u;this.isShiftKey=f}}var EAID={InsertElement:0,ShiftElement:1,MoveElement:2,ChangeElement:3,DeleteElement:4},ESAID={AddWindowTitle:0,DeleteWindowTitle:1,AddTextBlockText:100,DeleteTextBlockText:101,AddTextBoxText:200,DeleteTextBoxText:201},AAID={AddRule:0,ChangeRule:1,DeleteRule:2,AddBitmapImage:100,DeleteBitmapImage:101,AddLinearGradientBrush:200,DeleteLinearGradientBrush:201,AddRadialGradientBrush:300,DeleteRadialGradientBrush:301};